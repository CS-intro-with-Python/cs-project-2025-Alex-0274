{% extends "base.html" %}
{% block title %}{% if mode=='create' %}New Task{% else %}Edit Task{% endif %}{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-lg-8">
    <div class="card">
      <div class="card-body">
        <h4 class="mb-3">
          {% if mode=='create' %}Create task{% else %}Edit task{% endif %}
        </h4>

        {% if error %}
          <div class="alert alert-danger">{{ error }}</div>
        {% endif %}

        <form method="post" action="{{ form_action }}" id="taskForm">
          <div class="mb-3">
            <label class="form-label">Title *</label>
            <input
              class="form-control"
              name="title"
              id="titleInput"
              value="{{ task.title if task else '' }}"
              maxlength="200"
              required
            />
            <div class="form-text">Short and clear (required).</div>
          </div>

          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" name="description" rows="4">{{ task.description if task and task.description else '' }}</textarea>
          </div>

          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="form-label">Priority</label>
              <select class="form-select" name="priority">
                {% set p = task.priority if task else 2 %}
                <option value="1" {% if p==1 %}selected{% endif %}>Low</option>
                <option value="2" {% if p==2 %}selected{% endif %}>Medium</option>
                <option value="3" {% if p==3 %}selected{% endif %}>High</option>
              </select>
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">Due date</label>
              <input class="form-control" type="date" name="due_date"
                value="{% if task and task.due_date %}{{ task.due_date.strftime('%Y-%m-%d') }}{% endif %}">
              <div class="form-text">Optional.</div>
            </div>
          </div>

          <div class="d-flex gap-2 mt-4">
            <button class="btn btn-primary" type="submit">
              {% if mode=='create' %}Create{% else %}Save{% endif %}
            </button>
            <a class="btn btn-outline-secondary" href="{{ url_for('main.index') }}">Cancel</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/task_form.js') }}"></script>
{% endblock %}
